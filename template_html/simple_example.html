<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Tangle document</title>

	<!-- Tangle -->
	<script type="text/javascript" src="Tangle.js"></script>

	<!-- TangleKit (optional) -->
	<link rel="stylesheet" href="TangleKit/TangleKit.css" type="text/css">
	<script type="text/javascript" src="TangleKit/mootools.js"></script>
	<script type="text/javascript" src="TangleKit/sprintf.js"></script>
	<script type="text/javascript" src="TangleKit/BVTouchable.js"></script>
	<script type="text/javascript" src="TangleKit/TangleKit.js"></script>

	<!-- Cookie Example -->
	<script type="text/javascript">

		function setUpTangle () {

			var element = document.getElementById("cookieExample");

			var tangle = new Tangle(element, {
				initialize: function () {
					this.cookies = 4;
					this.caloriesPerCookie = 50;
				},
				update: function () {
					this.calories = this.cookies * this.caloriesPerCookie;
				}
			});
		}

	</script>

	<!-- Park Example -->
	<script type="text/javascript">
window.addEvent('domready', function () {

    new Tangle(document.getElementById("parkExample"), {

        initialize: function () {
            this.parkCount = 278;
            this.oldAdmission = 12;
            this.registeredVehicleCount = 28e6;  // http://www.yesforstateparks.com/get-the-facts/fact-sheets/general-fact-sheet
            this.taxpayerCount = 13657632;  // http://trac.syr.edu/tracirs/findings/aboutTP/states/California/counties/06000/06000main.html
            this.oldVisitorCount = 75e6;  // http://parks.ca.gov/pages/712/files/budget%20fact%20sheet%20w-graphics%20-%2001-14-08.pdf
            this.oldBudget = 400e6; // this is not really correct, it ignores revenue, but I couldn't find any revenue data
            this.oldClosedParkCount = 150;

            this.percentOfAdmissionConvertedToRevenue = 0.1;  // total BS, couldn't find real data, just trying to make the numbers work
            this.percentInStateVistors = 85;
            this.percentVehicleOwners = 95;

            this.tax = 18;
            this.percentCompliance = 100;
            this.isTaxPerVehicle = true;
            this.newAdmission = 0;
            this.newAdmissionAppliesToEveryone = false;
        },
        
        update: function () {
            var taxCount = this.isTaxPerVehicle ? this.registeredVehicleCount : this.taxpayerCount;
            this.taxCollected = this.tax * this.percentCompliance/100 * taxCount;
            
            var fractionOfVisitorsEligibleForNewAdmission = this.newAdmissionAppliesToEveryone ? 1 :
                (this.percentInStateVistors/100 * (this.isTaxPerVehicle ? (this.percentVehicleOwners/100) : 1));
            var averageAdmission = this.oldAdmission + fractionOfVisitorsEligibleForNewAdmission * (this.newAdmission - this.oldAdmission);

            // fake demand curve
            this.newVisitorCount = this.oldVisitorCount * Math.max(0.2, 1 + 0.5*Math.atan(1 - averageAdmission/this.oldAdmission));
            
            var oldRevenue = this.oldVisitorCount * this.oldAdmission * this.percentOfAdmissionConvertedToRevenue;
            var newRevenue = this.newVisitorCount * averageAdmission * this.percentOfAdmissionConvertedToRevenue;
            
            this.deltaRevenue = newRevenue - oldRevenue;
            this.deltaBudget = this.taxCollected + this.deltaRevenue;
            this.deltaVisitorCount = this.newVisitorCount - this.oldVisitorCount;
            this.relativeVisitorCount = Math.abs(this.deltaVisitorCount / this.oldVisitorCount);

            this.budget = this.oldBudget + this.deltaBudget;
            
            var maintainanceBudget = 600e6;
            var repairBudget = 750e6;
            var maxBudget = 1000e6;
            
            if (this.budget < maintainanceBudget) {
                this.scenarioIndex = 0;
                this.closedParkCount = this.oldClosedParkCount * (maintainanceBudget - this.budget) / (maintainanceBudget - this.oldBudget);
                this.closedParkCount = Math.round(this.closedParkCount);
            }
            else if (this.budget < repairBudget) {
                this.scenarioIndex = 1;
            }
            else if (this.budget < maxBudget) {
                this.scenarioIndex = 2;
                this.restorationTime = Math.round(10 - 9 * (this.budget - repairBudget) / (maxBudget - repairBudget));
            }
            else {
                this.scenarioIndex = 3;
                this.surplus = this.budget - maxBudget;
            }
        },
    });

});


	</script>



</head>

<body onload="setUpTangle();">

	<h1> <b>Cookie Example</b></h1>

	<p id="cookieExample">
		When you eat <span data-var="cookies" class="TKAdjustableNumber" data-min="2" data-max="100"> cookies</span>, you
		will consume <span data-var="calories"></span> calories.
	</p>

	
	<h1> <b>Park Example</b></h1>

	<!-- park example -->

<div class="example">
<div class="exampleTop"></div>
<div class="exampleCenter">
<div id="parkExample">

    <h5>Proposition 21:  Vehicle License Fee for State Parks</h5>
    
    <h6>The way it is now:</h6>
 
    <p>California has <span data-var="parkCount"></span> state parks, including state beaches and historic parks. 
        The current $<span data-var="oldBudget" data-format="e6"></span> million budget is insufficient to maintain these parks, 
        and <span data-var="oldClosedParkCount"></span> parks will be shut down at least part-time.
        Most parks charge <span data-var="oldAdmission" data-format="dollars"></span> per vehicle for admission.</p>

    <h6>What Prop 21 would do:</h6>
 
    <p>Proposes to charge car owners an extra $18 on their annual registration bill, to go into the state park fund.  Cars that pay the charge would have free park admission.</p>

    <h6>Analysis:</h6>

    <p>Suppose that an extra
        <span data-var="tax" data-format="$%d" class="TKAdjustableNumber" data-min="0" data-max="50"></span> was charged to
        <span data-var="percentCompliance" class="TKAdjustableNumber" data-min="0" data-max="100" data-step="5">%</span> of
        <span data-var="isTaxPerVehicle" class="TKToggle TKSwitch"><span>California taxpayers</span><span>vehicle registrations</span></span>.
        Park admission would be <span data-var="newAdmission" data-format="free" class="TKAdjustableNumber" data-min="0" data-max="25"></span> for
        <span data-var="newAdmissionAppliesToEveryone" class="TKToggle TKSwitch"><span>those who paid the charge</span><span>everyone</span></span>.
    </p>
    
    <p>This would <span data-var="deltaBudget" class="TKSwitchPositiveNegative"><span>collect an extra</span><span>lose</span></span>
        $<span data-var="deltaBudget" data-format="abs_e6"></span> million
        ($<span data-var="taxCollected" data-format="e6"></span> million from the tax,
        <span data-var="deltaRevenue" class="TKSwitchPositiveNegative"><span>plus</span><span>minus</span></span>
        $<span data-var="deltaRevenue" data-format="abs_e6"></span> million
        <span data-var="deltaRevenue" class="TKSwitchPositiveNegative"><span>additional</span><span>lost</span></span> revenue from admission)
        for a total state park budget of $<span data-var="budget" data-format="e6"></span> million.
        
    <span data-var="scenarioIndex" class="TKSwitch">
            <span>This is not sufficient to maintain the parks, and
                <span data-var="closedParkCount"></span>    parks would be shut down at least part-time.</span>
            <span>This is sufficient to maintain the parks in their current state, but not fund
                a program to bring safety and cleanliness up to acceptable standards.</span>
            <span>This is sufficient to maintain the parks in their current state, plus fund a program to 
                bring safety and cleanliness up to acceptable standards over the next
                <span data-var="restorationTime"></span> years.</span>
            <span>This is sufficient to maintain the parks and bring safety and cleanliness up to acceptable standards,
                leaving a $<span data-var="surplus" data-format="e6"></span> million per year surplus.</span>
        </span>
    </p>
    
    <p>Park attendance would
        <span data-var="deltaVisitorCount" class="TKSwitchPositiveNegative"><span>rise</span><span>fall</span></span> by
        <span data-var="relativeVisitorCount" data-format="percent"></span>, to
        <span data-var="newVisitorCount" data-format="e6"></span> million visits each year.</p>
</div>
</div>
<div class="exampleBottom"></div>
</div>


</body>
</html>
